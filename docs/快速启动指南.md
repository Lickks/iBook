# 快速启动指南

## 一、环境准备

### 1.1 必需软件

- **Node.js**: v18.0+ （推荐使用LTS版本）
- **npm**: v9.0+ （Node.js自带）或 **pnpm**: v8.0+（推荐，更快）
- **Git**: 版本控制
- **VSCode**: 推荐的代码编辑器

### 1.2 VSCode推荐插件

- **Vue - Official** (Vue语言支持)
- **ESLint** (代码规范)
- **Prettier** (代码格式化)
- **TypeScript Vue Plugin (Volar)** (TS支持)
- **Path Intellisense** (路径自动补全)
- **Auto Rename Tag** (标签自动重命名)

---

## 二、项目初始化

### 方式一：使用electron-vite模板（推荐）

```bash
# 1. 创建项目
npm create @quick-start/electron

# 或使用pnpm（更快）
pnpm create @quick-start/electron
```

**交互式选项：**
```
✔ Project name: … book-store
✔ Select a framework: › Vue
✔ Add TypeScript? … Yes
✔ Add Electron updater plugin? … Yes
✔ Enable Electron download mirror proxy? … No
```

```bash
# 2. 进入项目目录
cd book-store

# 3. 安装依赖
npm install
# 或
pnpm install

# 4. 启动开发服务器
npm run dev
# 或
pnpm dev
```

### 方式二：手动搭建

```bash
# 1. 创建项目目录
mkdir book-store
cd book-store

# 2. 初始化package.json
npm init -y

# 3. 安装核心依赖
npm install vue@latest vue-router@latest pinia@latest
npm install electron@latest

# 4. 安装开发依赖
npm install -D vite@latest @vitejs/plugin-vue electron-builder
npm install -D typescript @vue/tsconfig vue-tsc
npm install -D eslint prettier @typescript-eslint/parser

# 5. 手动配置vite.config.ts、tsconfig.json等（参考模板）
```

---

## 三、安装项目依赖

### 3.1 UI组件库

```bash
# Element Plus
npm install element-plus
npm install -D unplugin-vue-components unplugin-auto-import
```

### 3.2 数据库

```bash
# SQLite数据库
npm install better-sqlite3
npm install -D @types/better-sqlite3
```

### 3.3 HTTP请求与网页解析

```bash
# Axios + Cheerio
npm install axios cheerio
npm install -D @types/cheerio
```

### 3.4 文档解析

```bash
# 各种文档格式解析
npm install epub pdf-parse mammoth
npm install jschardet iconv-lite
npm install -D @types/epub
```

### 3.5 工具库

```bash
# 日期、工具函数、UUID
npm install dayjs lodash-es uuid
npm install -D @types/lodash-es @types/uuid
```

### 3.6 图表库

```bash
# ECharts
npm install echarts
npm install -D @types/echarts
```

### 3.7 日志记录

```bash
# Electron日志
npm install electron-log
```

---

## 四、配置文件

### 4.1 package.json 脚本配置

```json
{
  "name": "ibook",
  "version": "1.0.0",
  "description": "网络小说阅读管理工具",
  "main": "dist-electron/main.js",
  "scripts": {
    "dev": "vite",
    "build": "vue-tsc --noEmit && vite build && electron-builder",
    "preview": "vite preview",
    "lint": "eslint . --ext .vue,.js,.jsx,.cjs,.mjs,.ts,.tsx,.cts,.mts --fix",
    "format": "prettier --write src/",
    "type-check": "vue-tsc --noEmit"
  },
  "dependencies": {
    "vue": "^3.4.0",
    "vue-router": "^4.2.0",
    "pinia": "^2.1.0",
    "electron": "^28.0.0",
    "element-plus": "^2.5.0",
    "axios": "^1.6.0",
    "cheerio": "^1.0.0-rc.12",
    "better-sqlite3": "^9.2.0",
    "dayjs": "^1.11.0",
    "lodash-es": "^4.17.21",
    "uuid": "^9.0.0",
    "epub": "^1.2.0",
    "pdf-parse": "^1.1.1",
    "mammoth": "^1.6.0",
    "jschardet": "^3.1.0",
    "iconv-lite": "^0.6.3",
    "echarts": "^5.4.0",
    "electron-log": "^5.0.0"
  },
  "devDependencies": {
    "@vitejs/plugin-vue": "^5.0.0",
    "vite": "^5.0.0",
    "typescript": "^5.3.0",
    "vue-tsc": "^1.8.0",
    "electron-builder": "^24.9.0",
    "@vue/tsconfig": "^0.5.0",
    "eslint": "^8.55.0",
    "prettier": "^3.1.0",
    "@typescript-eslint/parser": "^6.15.0",
    "unplugin-vue-components": "^0.26.0",
    "unplugin-auto-import": "^0.17.0",
    "@types/better-sqlite3": "^7.6.8",
    "@types/cheerio": "^0.22.35",
    "@types/lodash-es": "^4.17.12",
    "@types/uuid": "^9.0.7"
  }
}
```

### 4.2 vite.config.ts

```typescript
import { defineConfig } from 'vite'
import vue from '@vitejs/plugin-vue'
import AutoImport from 'unplugin-auto-import/vite'
import Components from 'unplugin-vue-components/vite'
import { ElementPlusResolver } from 'unplugin-vue-components/resolvers'
import electron from 'vite-plugin-electron'
import path from 'path'

export default defineConfig({
  plugins: [
    vue(),
    // Element Plus 按需导入
    AutoImport({
      resolvers: [ElementPlusResolver()],
      imports: ['vue', 'vue-router', 'pinia']
    }),
    Components({
      resolvers: [ElementPlusResolver()]
    }),
    // Electron
    electron([
      {
        entry: 'electron/main.ts',
        vite: {
          build: {
            outDir: 'dist-electron'
          }
        }
      },
      {
        entry: 'electron/preload.ts',
        vite: {
          build: {
            outDir: 'dist-electron'
          }
        }
      }
    ])
  ],
  resolve: {
    alias: {
      '@': path.resolve(__dirname, 'src')
    }
  },
  server: {
    port: 5173
  }
})
```

### 4.3 tsconfig.json

```json
{
  "extends": "@vue/tsconfig/tsconfig.dom.json",
  "compilerOptions": {
    "target": "ES2020",
    "module": "ESNext",
    "lib": ["ES2020", "DOM", "DOM.Iterable"],
    "skipLibCheck": true,
    "strict": true,
    "moduleResolution": "bundler",
    "resolveJsonModule": true,
    "esModuleInterop": true,
    "allowSyntheticDefaultImports": true,
    "forceConsistentCasingInFileNames": true,
    "baseUrl": ".",
    "paths": {
      "@/*": ["./src/*"]
    },
    "types": ["vite/client", "element-plus/global"]
  },
  "include": [
    "src/**/*.ts",
    "src/**/*.tsx",
    "src/**/*.vue",
    "electron/**/*.ts"
  ],
  "exclude": ["node_modules", "dist", "dist-electron"]
}
```

### 4.4 .eslintrc.js

```javascript
module.exports = {
  root: true,
  env: {
    node: true,
    browser: true,
    es2021: true
  },
  extends: [
    'eslint:recommended',
    'plugin:vue/vue3-recommended',
    'plugin:@typescript-eslint/recommended'
  ],
  parser: 'vue-eslint-parser',
  parserOptions: {
    parser: '@typescript-eslint/parser',
    ecmaVersion: 2021,
    sourceType: 'module'
  },
  rules: {
    'vue/multi-word-component-names': 'off',
    '@typescript-eslint/no-explicit-any': 'warn',
    'no-console': process.env.NODE_ENV === 'production' ? 'warn' : 'off',
    'no-debugger': process.env.NODE_ENV === 'production' ? 'warn' : 'off'
  }
}
```

### 4.5 .prettierrc

```json
{
  "semi": false,
  "singleQuote": true,
  "printWidth": 80,
  "trailingComma": "none",
  "arrowParens": "avoid",
  "endOfLine": "auto"
}
```

### 4.6 electron-builder.json

```json
{
  "appId": "com.ibook.app",
  "productName": "iBook",
  "directories": {
    "output": "release"
  },
  "files": [
    "dist/**/*",
    "dist-electron/**/*"
  ],
  "win": {
    "target": [
      {
        "target": "nsis",
        "arch": ["x64"]
      }
    ],
    "icon": "public/icon.png"
  },
  "nsis": {
    "oneClick": false,
    "allowToChangeInstallationDirectory": true,
    "createDesktopShortcut": true,
    "createStartMenuShortcut": true
  }
}
```

---

## 五、创建基础代码框架

### 5.1 数据库初始化

创建 `database/schema.sql`:

```sql
-- 书籍表
CREATE TABLE IF NOT EXISTS books (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    title VARCHAR(200) NOT NULL,
    author VARCHAR(100),
    cover_url VARCHAR(500),
    platform VARCHAR(100),
    category VARCHAR(50),
    description TEXT,
    word_count_source VARCHAR(20) DEFAULT 'search',
    word_count_search INTEGER,
    word_count_document INTEGER,
    word_count_manual INTEGER,
    word_count_display INTEGER,
    isbn VARCHAR(50),
    source_url VARCHAR(500),
    reading_status VARCHAR(20) DEFAULT 'unread',
    personal_rating DECIMAL(2,1),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    updated_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 文档表
CREATE TABLE IF NOT EXISTS documents (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    book_id INTEGER NOT NULL,
    file_name VARCHAR(200) NOT NULL,
    file_path VARCHAR(500) NOT NULL,
    file_type VARCHAR(20) NOT NULL,
    file_size INTEGER,
    word_count INTEGER,
    uploaded_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (book_id) REFERENCES books(id) ON DELETE CASCADE
);

-- 阅读进度表
CREATE TABLE IF NOT EXISTS reading_progress (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    book_id INTEGER NOT NULL,
    current_chapter VARCHAR(200),
    current_page INTEGER,
    progress_percentage DECIMAL(5,2),
    last_read_at DATETIME,
    FOREIGN KEY (book_id) REFERENCES books(id) ON DELETE CASCADE
);

-- 笔记表
CREATE TABLE IF NOT EXISTS notes (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    book_id INTEGER NOT NULL,
    note_type VARCHAR(20),
    content TEXT,
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (book_id) REFERENCES books(id) ON DELETE CASCADE
);

-- 标签表
CREATE TABLE IF NOT EXISTS tags (
    id INTEGER PRIMARY KEY AUTOINCREMENT,
    tag_name VARCHAR(50) UNIQUE NOT NULL,
    color VARCHAR(20),
    created_at DATETIME DEFAULT CURRENT_TIMESTAMP
);

-- 书籍标签关联表
CREATE TABLE IF NOT EXISTS book_tags (
    book_id INTEGER NOT NULL,
    tag_id INTEGER NOT NULL,
    PRIMARY KEY (book_id, tag_id),
    FOREIGN KEY (book_id) REFERENCES books(id) ON DELETE CASCADE,
    FOREIGN KEY (tag_id) REFERENCES tags(id) ON DELETE CASCADE
);

-- 创建索引
CREATE INDEX IF NOT EXISTS idx_books_title ON books(title);
CREATE INDEX IF NOT EXISTS idx_books_author ON books(author);
CREATE INDEX IF NOT EXISTS idx_books_status ON books(reading_status);
CREATE INDEX IF NOT EXISTS idx_books_created_at ON books(created_at);
CREATE INDEX IF NOT EXISTS idx_documents_book_id ON documents(book_id);
CREATE INDEX IF NOT EXISTS idx_notes_book_id ON notes(book_id);
```

### 5.2 TypeScript类型定义

创建 `src/types/book.ts`:

```typescript
export interface Book {
  id: number
  title: string
  author?: string
  coverUrl?: string
  platform?: string
  category?: string
  description?: string
  wordCountSource: 'search' | 'document' | 'manual'
  wordCountSearch?: number
  wordCountDocument?: number
  wordCountManual?: number
  wordCountDisplay?: number
  isbn?: string
  sourceUrl?: string
  readingStatus: 'unread' | 'reading' | 'finished' | 'dropped' | 'to-read'
  personalRating?: number
  createdAt: string
  updatedAt: string
}

export interface BookInput {
  title: string
  author?: string
  coverUrl?: string
  platform?: string
  category?: string
  description?: string
  wordCountDisplay?: number
  wordCountSource?: 'search' | 'document' | 'manual'
  isbn?: string
  sourceUrl?: string
  readingStatus?: string
  personalRating?: number
}

export interface Document {
  id: number
  bookId: number
  fileName: string
  filePath: string
  fileType: string
  fileSize: number
  wordCount?: number
  uploadedAt: string
}

export interface SearchResult {
  title: string
  author: string
  cover: string
  platform: string
  wordCount: number
  description: string
  sourceUrl: string
}
```

### 5.3 Electron主进程入口

创建 `electron/main.ts`:

```typescript
import { app, BrowserWindow, ipcMain } from 'electron'
import path from 'path'
import { db } from './services/database'
import { setupBookHandlers } from './ipc/bookHandler'
import { setupDocumentHandlers } from './ipc/documentHandler'
import { setupSearchHandlers } from './ipc/searchHandler'

let mainWindow: BrowserWindow | null = null

function createWindow() {
  mainWindow = new BrowserWindow({
    width: 1200,
    height: 800,
    minWidth: 1000,
    minHeight: 600,
    webPreferences: {
      preload: path.join(__dirname, 'preload.js'),
      contextIsolation: true,
      nodeIntegration: false
    }
  })

  // 开发环境加载Vite服务器
  if (process.env.NODE_ENV === 'development') {
    mainWindow.loadURL('http://localhost:5173')
    mainWindow.webContents.openDevTools()
  } else {
    // 生产环境加载打包后的文件
    mainWindow.loadFile(path.join(__dirname, '../dist/index.html'))
  }

  mainWindow.on('closed', () => {
    mainWindow = null
  })
}

app.whenReady().then(() => {
  // 初始化数据库
  db.init()

  // 注册IPC处理器
  setupBookHandlers()
  setupDocumentHandlers()
  setupSearchHandlers()

  createWindow()

  app.on('activate', () => {
    if (BrowserWindow.getAllWindows().length === 0) {
      createWindow()
    }
  })
})

app.on('window-all-closed', () => {
  if (process.platform !== 'darwin') {
    app.quit()
  }
})
```

### 5.4 Preload脚本

创建 `electron/preload.ts`:

```typescript
import { contextBridge, ipcRenderer } from 'electron'

// 暴露安全的API给渲染进程
contextBridge.exposeInMainWorld('electronAPI', {
  // 书籍操作
  book: {
    create: (data: any) => ipcRenderer.invoke('book:create', data),
    update: (id: number, data: any) => ipcRenderer.invoke('book:update', id, data),
    delete: (id: number) => ipcRenderer.invoke('book:delete', id),
    getById: (id: number) => ipcRenderer.invoke('book:getById', id),
    getAll: () => ipcRenderer.invoke('book:getAll'),
    search: (keyword: string) => ipcRenderer.invoke('book:search', keyword)
  },

  // 文档操作
  document: {
    upload: (filePath: string, bookId: number) => 
      ipcRenderer.invoke('document:upload', filePath, bookId),
    delete: (id: number) => ipcRenderer.invoke('document:delete', id),
    open: (filePath: string) => ipcRenderer.invoke('document:open', filePath),
    countWords: (filePath: string) => ipcRenderer.invoke('document:countWords', filePath)
  },

  // 搜索操作
  search: {
    youshu: (keyword: string) => ipcRenderer.invoke('search:youshu', keyword)
  }
})

// 类型声明
export interface ElectronAPI {
  book: {
    create: (data: any) => Promise<any>
    update: (id: number, data: any) => Promise<any>
    delete: (id: number) => Promise<boolean>
    getById: (id: number) => Promise<any>
    getAll: () => Promise<any[]>
    search: (keyword: string) => Promise<any[]>
  }
  document: {
    upload: (filePath: string, bookId: number) => Promise<any>
    delete: (id: number) => Promise<boolean>
    open: (filePath: string) => Promise<void>
    countWords: (filePath: string) => Promise<number>
  }
  search: {
    youshu: (keyword: string) => Promise<any[]>
  }
}

declare global {
  interface Window {
    electronAPI: ElectronAPI
  }
}
```

---

## 六、开发流程

### 6.1 第一步：验证环境

```bash
# 启动开发服务器
npm run dev

# 应该看到Electron窗口打开，显示Vue应用
```

### 6.2 第二步：实现数据库服务

按照《技术选型与架构设计》文档中的示例，创建：
- `electron/services/database.ts`
- `electron/ipc/bookHandler.ts`

### 6.3 第三步：实现Vue页面

创建基础页面：
- `src/views/Home.vue` - 书籍列表
- `src/components/BookCard.vue` - 书籍卡片

### 6.4 第四步：连通数据流

1. 创建Pinia Store
2. 在页面中调用 `window.electronAPI`
3. 验证数据能够正常增删改查

### 6.5 第五步：逐步添加功能

按照MVP -> 扩展功能的顺序逐步实现

---

## 七、常见问题

### Q1: 启动报错 "Cannot find module 'electron'"
**解决：** 确保已安装electron依赖
```bash
npm install electron
```

### Q2: TypeScript报错 "Cannot find name 'electronAPI'"
**解决：** 在 `src/types/global.d.ts` 中添加类型声明
```typescript
import { ElectronAPI } from '../../electron/preload'

declare global {
  interface Window {
    electronAPI: ElectronAPI
  }
}
```

### Q3: Element Plus样式不生效
**解决：** 在 `src/main.ts` 中导入样式
```typescript
import 'element-plus/dist/index.css'
```

### Q4: SQLite报错 "better_sqlite3.node 不兼容"
**解决：** 需要重新编译原生模块
```bash
npm rebuild better-sqlite3 --build-from-source
```

### Q5: 打包后应用无法运行
**解决：** 
1. 检查 `electron-builder.json` 配置
2. 确保打包包含了所有必需的文件
3. 原生模块需要配置 `extraResources`

---

## 八、开发工具推荐

### 8.1 调试工具

- **Vue DevTools**: Chrome扩展，调试Vue组件
- **Electron DevTools**: 内置，F12打开
- **SQLite Browser**: 查看数据库内容

### 8.2 性能分析

- **Chrome Performance**: 分析渲染性能
- **electron-devtools-installer**: 安装Chrome DevTools扩展

---

## 九、下一步

1. [已完成] 完成环境搭建
2. ⬜ 实现数据库服务
3. ⬜ 创建书籍列表页面
4. ⬜ 实现添加书籍功能
5. ⬜ 集成youshu.me搜索
6. ⬜ 实现文档上传
7. ⬜ 添加字数统计

**祝你开发顺利！** 如有问题，随时查阅文档或搜索相关资料。

