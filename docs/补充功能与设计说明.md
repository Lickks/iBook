# 补充功能与设计说明

## 一、相比原始需求新增的功能

### 1.1 已在需求文档中补充的核心功能

#### 阅读进度管理 ⭐⭐⭐⭐⭐
**为什么重要：**
- 这是阅读管理工具的灵魂功能
- 避免"读到哪里忘记了"的痛点
- 特别是对于长篇小说（100万字+），进度管理至关重要

**功能点：**
- 记录当前章节/页数
- 阅读百分比可视化
- 五种状态：未读、阅读中、已读完、弃读、待读
- 阅读历史记录（可追溯历史进度）

**应用场景：**
```
用户读完第50章，记录：
- 当前章节："第50章 转折点"
- 进度：15.5%
- 最后阅读时间：2024-11-24 14:30
```

---

#### 个人评分与笔记系统 ⭐⭐⭐⭐⭐
**为什么重要：**
- 记录个人阅读体验，建立个人的"阅读档案"
- 方便回顾和推荐给他人
- 书摘收藏功能让你保存喜欢的句子

**功能点：**
- 5星评分系统（0.5星精度）
- 三种笔记类型：
  - 书评：整体评价
  - 笔记：阅读感想
  - 摘抄：精彩句段
- 支持Markdown格式（富文本）

**应用场景：**
```
《诡秘之主》评分: 5.0星
书评: "世界观宏大，伏笔惊人，强烈推荐！"
摘抄: "历史的车轮滚滚向前，我们都是其中的一粒尘埃。"
```

---

#### 标签系统 ⭐⭐⭐⭐
**为什么重要：**
- 分类系统的补充，提供更灵活的组织方式
- 一本书可以有多个标签
- 方便创建个性化的分类维度

**功能点：**
- 自定义标签名称和颜色
- 一本书可以打多个标签
- 按标签筛选和统计

**预设标签：**
- 经典
- 值得重读
- 强烈推荐
- 神作
- 正在追更

**应用场景：**
```
《全职高手》
标签: #经典 #值得重读 #电竞 #热血
```

---

#### 统计分析与可视化 ⭐⭐⭐⭐
**为什么重要：**
- 让用户了解自己的阅读习惯
- 增加工具的趣味性和成就感
- 年度报告功能类似于网易云音乐年度总结

**统计维度：**
1. **总体统计：**
   - 总书籍数
   - 总阅读字数
   - 已完成数量
   - 平均评分

2. **类型分布：**
   - 饼图展示各类型占比
   - 各类型平均评分

3. **平台分布：**
   - 从哪些平台读的书最多

4. **时间趋势：**
   - 按月统计添加数量
   - 阅读完成趋势

5. **年度报告：**
   - 类似于年终总结
   - 可导出图片分享

**可视化工具：ECharts**

---

#### 备份与同步 ⭐⭐⭐⭐
**为什么重要：**
- 数据安全是本地应用的首要考虑
- 防止数据丢失（系统崩溃、误删）
- 为未来的云同步功能预留接口

**功能点：**
1. **自动备份：**
   - 每周自动备份
   - 保留最近10个备份
   - 备份位置：`userData/backups/`

2. **手动备份：**
   - 一键导出所有数据
   - 格式：JSON（包含完整数据）
   - 格式：Excel（书籍列表）

3. **数据恢复：**
   - 从备份文件恢复
   - 恢复前自动创建当前状态的备份

4. **云同步（可选）：**
   - 未来可以对接云存储服务
   - 支持多设备同步

---

#### 批量操作 ⭐⭐⭐
**为什么重要：**
- 当书籍数量较多时（100+），批量操作能显著提高效率
- 减少重复性操作

**功能点：**
- 批量选择（Checkbox）
- 批量删除
- 批量修改状态
- 批量添加标签
- 批量导出

**应用场景：**
```
选中10本"已读完"的书，批量添加标签"2024年度精选"
```

---

#### 多数据源检索 ⭐⭐⭐
**为什么重要：**
- youshu.me可能不包含所有小说
- 多数据源提高检索成功率
- 不同平台数据质量不同，可以对比

**支持的数据源：**
1. **youshu.me**（主要）
2. **豆瓣读书**（补充）
3. **起点中文网API**（如果可用）
4. **晋江文学城**（如果可用）

**检索策略：**
- 优先从youshu.me检索
- 失败后尝试其他数据源
- 展示所有来源的结果供用户选择

---

### 1.2 其他细节补充

#### 主题与界面定制 ⭐⭐⭐
- 明暗主题切换（护眼）
- 根据系统主题自动切换
- 封面显示方式：网格/列表/详情
- 字体大小调整

#### 封面管理优化 ⭐⭐⭐
**原始需求：** 只考虑了记录封面URL

**补充设计：**
1. **网络封面自动下载：**
   - 从检索结果获取的封面URL
   - 自动下载到本地（避免失效）
   - 存储路径：`userData/covers/{bookId}.jpg`

2. **手动上传封面：**
   - 支持拖拽上传
   - 支持常见图片格式（JPG, PNG, WebP）
   - 自动压缩和裁剪

3. **默认封面：**
   - 没有封面时使用默认图片
   - 或根据书名生成首字母头像

---

#### 文档预览功能 ⭐⭐⭐
**为什么重要：**
- 上传文档后，用户想快速确认是否是正确的文件
- 避免上传错误

**功能点：**
- TXT：直接预览前1000字
- EPUB/PDF：提取前几页预览
- 双击封面或文档名快速预览

---

#### 快捷键支持 ⭐⭐⭐
**为什么重要：**
- 提高效率，减少鼠标操作
- 重度用户的刚需

**常用快捷键：**
- `Ctrl + N`：新建书籍
- `Ctrl + F`：搜索
- `Ctrl + S`：保存
- `Delete`：删除选中项
- `Ctrl + A`：全选
- `F5`：刷新列表
- `Ctrl + B`：备份数据

---

#### 导入现有数据 ⭐⭐⭐⭐
**为什么重要：**
- 降低用户迁移成本
- 快速积累数据，增加用户粘性

**支持的导入方式：**
1. **从Excel导入：**
   - 提供Excel模板
   - 用户填写后批量导入

2. **从豆瓣导入：**
   - 如果用户在豆瓣记录过阅读
   - 通过豆瓣API或导出文件导入

3. **从其他阅读管理工具导入：**
   - 如果有标准的导出格式
   - 提供转换工具

---

#### 小说更新提醒 ⭐⭐
**为什么重要：**
- 对于连载小说，用户关心是否更新
- 避免频繁打开网站查看

**功能点：**
- 标记"正在追更"的小说
- 定期检查是否有更新（需要API支持）
- 弹窗通知或托盘提醒

**技术难点：**
- 需要各平台的API支持（可能较难）
- 或者定期爬取网页检测（可能被封）

**建议：**
- 作为可选功能，优先级较低
- 可以先做手动刷新功能

---

## 二、未考虑到的边界场景

### 2.1 数据完整性

#### 场景1：重复添加检测
**问题：** 用户可能无意中添加同一本书两次

**解决方案：**
- 添加前检测是否已存在（书名+作者）
- 如果存在，提示用户：
  - "《书名》已存在，是否覆盖？"
  - "是否编辑现有记录？"
  - "取消添加"

#### 场景2：关联数据删除
**问题：** 删除书籍时，文档、笔记、进度等关联数据如何处理？

**解决方案：**
- 数据库设置 `ON DELETE CASCADE`
- 删除前确认："确定删除《书名》及其所有关联数据（文档、笔记）吗？"
- 提供"软删除"选项（只是标记删除，不真正删除）

#### 场景3：文档文件丢失
**问题：** 数据库中记录了文档路径，但文件被用户手动删除

**解决方案：**
- 打开文档前检测文件是否存在
- 如果不存在，提示："文档文件不存在，可能已被删除"
- 提供"重新上传"或"移除记录"选项

---

### 2.2 网络请求相关

#### 场景4：网络请求超时
**问题：** 检索时网络不佳或服务器无响应

**解决方案：**
- 设置合理的超时时间（10秒）
- 超时后提示："检索超时，请检查网络或稍后重试"
- 提供"重试"按钮
- 支持取消正在进行的请求

#### 场景5：检索结果为空
**问题：** 搜索关键词在数据源中没有匹配结果

**解决方案：**
- 提示："未找到《关键词》相关结果"
- 建议："尝试调整关键词或手动添加"
- 直接跳转到手动添加界面

#### 场景6：数据源网站结构变化
**问题：** youshu.me更新了网页结构，导致爬虫失效

**解决方案：**
- 设计灵活的爬虫架构，便于调整
- 提供配置文件，可以更新选择器
- 爬虫失败时，自动切换到其他数据源
- 最坏情况，提示用户手动添加

---

### 2.3 文件操作相关

#### 场景7：大文件上传
**问题：** 小说文档可能很大（如100MB+的PDF）

**解决方案：**
- 限制文件大小（建议200MB以内）
- 超过限制时提示："文件过大，建议压缩或分卷上传"
- 上传时显示进度条
- 支持取消上传

#### 场景8：文档格式不支持
**问题：** 用户上传了不支持的格式（如RAR压缩包）

**解决方案：**
- 上传前校验文件扩展名
- 不支持的格式拒绝上传，提示："不支持的文件格式"
- 列出支持的格式：TXT, EPUB, PDF, MOBI, DOCX

#### 场景9：文档字数统计失败
**问题：** 文档损坏或格式特殊，无法解析

**解决方案：**
- 捕获解析异常
- 提示："字数统计失败，请手动输入字数"
- 允许用户选择忽略或重新上传

#### 场景10：TXT文件乱码
**问题：** TXT文件编码不正确（如GBK vs UTF-8）

**解决方案：**
- 使用 `jschardet` 自动检测编码
- 支持常见编码：UTF-8, GBK, GB2312, Big5
- 仍然乱码时，提示用户手动选择编码

---

### 2.4 数据安全相关

#### 场景11：数据库文件损坏
**问题：** 系统崩溃或异常关机导致数据库损坏

**解决方案：**
- SQLite 设置 `PRAGMA journal_mode = WAL`（Write-Ahead Logging）
- 定期自动备份（每周）
- 启动时检测数据库完整性
- 损坏时自动从最近的备份恢复

#### 场景12：备份文件过多
**问题：** 自动备份占用大量磁盘空间

**解决方案：**
- 只保留最近10个备份
- 超过10个时，自动删除最旧的
- 提供手动清理备份的选项
- 显示备份占用的总空间

---

### 2.5 用户体验相关

#### 场景13：首次使用
**问题：** 新用户不知道如何开始

**解决方案：**
- 首次启动显示欢迎页面
- 提供简单的引导教程（可跳过）
- 空状态时显示友好的提示："点击'添加小说'开始记录你的阅读历程"

#### 场景14：数据量大时的性能
**问题：** 书籍数量超过1000本时，列表加载慢

**解决方案：**
- 分页加载（每页50-100条）
- 虚拟滚动（只渲染可见区域）
- 数据库查询优化（索引）
- 提供"搜索"和"筛选"快速定位

#### 场景15：封面加载慢
**问题：** 网络封面加载慢，影响体验

**解决方案：**
- 优先显示默认封面或占位图
- 封面下载到本地后再显示
- 图片懒加载（滚动到可见区域才加载）
- 封面图片压缩（宽度限制400px）

---

## 三、技术实现的细节考虑

### 3.1 字数统计的准确性

**挑战：** 不同格式的字数统计规则不同

**方案1：只统计中文字符**
```typescript
const chineseChars = text.match(/[\u4e00-\u9fa5]/g)
return chineseChars ? chineseChars.length : 0
```

**方案2：中文字符 + 英文单词**
```typescript
const chinese = text.match(/[\u4e00-\u9fa5]/g) || []
const english = text.match(/[a-zA-Z]+/g) || []
return chinese.length + english.length
```

**建议：** 提供设置选项，让用户选择统计规则

---

### 3.2 封面图片的存储策略

**问题：** 封面图片存储在哪里？

**方案对比：**

| 方案 | 优点 | 缺点 |
|------|------|------|
| 存储URL | 不占本地空间 | 可能失效 |
| 下载到本地 | 永久有效 | 占用空间 |
| Base64存数据库 | 数据完整 | 数据库膨胀 |

**推荐方案：** 下载到本地
- 路径：`userData/covers/{bookId}.jpg`
- 自动压缩图片（宽度400px）
- 数据库只存储本地路径

---

### 3.3 搜索功能的实现

**方案1：SQL LIKE查询**
```sql
SELECT * FROM books WHERE title LIKE '%关键词%'
```
- 优点：简单直接
- 缺点：不支持分词，模糊匹配不准确

**方案2：SQLite FTS5全文搜索**
```sql
CREATE VIRTUAL TABLE books_fts USING fts5(title, author, description);
```
- 优点：搜索更快，支持分词
- 缺点：需要维护额外的索引表

**推荐：** MVP阶段使用LIKE，后期优化时引入FTS5

---

### 3.4 数据库版本管理

**为什么需要：**
- 软件更新时，数据库结构可能变化
- 需要平滑迁移用户数据

**方案：**
1. 数据库中存储版本号
```sql
CREATE TABLE schema_version (version INTEGER);
INSERT INTO schema_version VALUES (1);
```

2. 每次启动时检查版本
```typescript
const currentVersion = db.getVersion()
if (currentVersion < LATEST_VERSION) {
  runMigrations(currentVersion, LATEST_VERSION)
}
```

3. 编写迁移脚本
```
database/migrations/
  - 001_init.sql
  - 002_add_tags.sql
  - 003_add_progress.sql
```

---

## 四、开发建议与最佳实践

### 4.1 MVP开发顺序

**第一周：框架搭建**
1. ✅ 初始化Electron + Vue项目
2. ✅ 配置TypeScript、ESLint
3. ✅ 创建数据库结构
4. ✅ 实现数据库服务（CRUD）

**第二周：核心功能**
1. 实现书籍列表展示
2. 实现添加书籍（手动录入）
3. 实现编辑和删除
4. 测试数据持久化

**第三周：检索功能**
1. 实现youshu.me爬虫
2. 集成到添加页面
3. 处理异常和错误

**第四周：文档管理**
1. 实现文档上传
2. 实现TXT字数统计
3. 支持多格式文档

**第五周及以后：扩展功能**
- 阅读进度管理
- 统计分析
- 主题切换
- 数据备份

---

### 4.2 代码组织建议

#### 关注点分离
- **主进程**：数据库、文件系统、网络请求（重逻辑）
- **渲染进程**：UI展示、用户交互（重视图）
- **IPC层**：清晰的接口定义

#### 模块化
- 每个功能独立成模块
- 便于测试和维护

#### 类型安全
- 充分利用TypeScript
- 定义清晰的接口和类型

---

### 4.3 性能优化建议

1. **数据库查询优化**
   - 合理使用索引
   - 避免 `SELECT *`
   - 使用分页查询

2. **前端渲染优化**
   - 虚拟滚动
   - 图片懒加载
   - 组件懒加载

3. **文件操作优化**
   - 异步操作避免阻塞
   - 使用Worker线程处理耗时任务

---

## 五、总结与展望

### 5.1 核心价值

这个项目的核心价值在于：
1. **本地化管理**：数据安全，隐私可控
2. **自动化**：减少手动录入，提高效率
3. **可视化**：了解阅读习惯，增加成就感
4. **可扩展**：架构清晰，易于添加新功能

### 5.2 与竞品对比

可能的竞品：
- **豆瓣读书**：在线服务，数据不在本地，功能有限
- **Calibre**：专业电子书管理，学习曲线陡峭，UI老旧
- **各种在线记录网站**：依赖网络，数据不可控

**本项目的优势：**
- 专注网络小说（而非纸质书或电子书）
- 本地化，数据自主
- 现代化的UI
- 灵活的自定义能力

### 5.3 未来展望

**短期（3个月）：**
- 完成MVP
- 发布第一个可用版本
- 收集用户反馈

**中期（6个月）：**
- 添加高级功能
- 性能优化
- 多数据源支持

**长期（1年+）：**
- 云同步功能
- 移动端App
- 社交功能
- AI推荐

---

## 六、给开发者的寄语

这是一个非常有趣且实用的项目，既能满足个人需求，又能作为作品集展示。

**开发过程中的建议：**
1. **不要追求完美**：MVP先行，快速迭代
2. **用户体验优先**：功能再多，不好用也是白搭
3. **记录开发过程**：写博客、做笔记，未来这些都是宝贵经验
4. **保持代码质量**：规范命名、适当注释、及时重构

**遇到困难时：**
- 查阅官方文档
- 搜索GitHub Issues
- 寻求社区帮助

**祝开发顺利！期待看到你的作品！** 🚀

