# iBook 开发任务清单

## 📋 项目进度追踪

### 阶段一：项目初始化与环境搭建

- [x] **1.1 环境准备**
  - [x] 安装 Node.js (v18+)
  - [x] 安装 pnpm (或 npm)
  - [x] 安装 VSCode 及推荐插件
  - [x] 安装 Git

- [x] **1.2 项目初始化**
  - [x] 使用 electron-vite 创建项目
  - [x] 配置 TypeScript
  - [x] 配置 ESLint 和 Prettier
  - [x] 配置 vite.config.ts（electron.vite.config.ts）
  - [x] 创建项目目录结构

- [x] **1.3 依赖安装**
  - [x] 安装 Vue 生态（Vue, Router, Pinia）
  - [x] 安装 Element Plus
  - [x] 安装 better-sqlite3
  - [x] 安装 axios, cheerio
  - [x] 安装文档解析库（epub, pdf-parse, mammoth）
  - [x] 安装工具库（dayjs, lodash-es, uuid）

- [x] **1.4 Git 初始化**
  - [x] 初始化 Git 仓库
  - [x] 创建 .gitignore
  - [x] 首次提交

---

### 阶段二：数据库设计与服务实现

- [x] **2.1 数据库设计**
  - [x] 创建 schema.sql（已提供）
  - [x] 设计数据表结构
    - [x] books 表
    - [x] documents 表
    - [x] reading_progress 表
    - [x] notes 表
    - [x] tags 表
    - [x] book_tags 表
  - [x] 创建索引
  - [x] 创建视图（统计用）

- [x] **2.2 数据库服务实现**
  - [x] 创建 `src/main/services/database.ts`
  - [x] 实现数据库初始化
  - [x] 实现书籍 CRUD
    - [x] createBook
    - [x] getBookById
    - [x] getAllBooks
    - [x] updateBook
    - [x] deleteBook
    - [x] searchBooks
  - [x] 实现文档 CRUD
    - [x] createDocument
    - [x] getDocumentById
    - [x] getDocumentsByBookId
    - [x] updateDocument
    - [x] deleteDocument
  - [x] 实现笔记 CRUD
    - [x] createNote
    - [x] getNoteById
    - [x] getNotesByBookId
    - [x] updateNote
    - [x] deleteNote
  - [x] 实现标签 CRUD
    - [x] createTag
    - [x] getTagById
    - [x] getAllTags
    - [x] getTagByName
    - [x] updateTag
    - [x] deleteTag
    - [x] addTagToBook
    - [x] removeTagFromBook
    - [x] getTagsByBookId
  - [x] 实现阅读进度 CRUD
    - [x] upsertReadingProgress
    - [x] getReadingProgressByBookId
    - [x] deleteReadingProgress
  - [ ] 编写单元测试

- [x] **2.3 TypeScript 类型定义**
  - [x] 定义 `Book` 接口
  - [x] 定义 `Document` 接口
  - [x] 定义 `Note` 接口
  - [x] 定义 `Tag` 接口
  - [x] 定义 `ReadingProgress` 接口
  - [x] 定义 `SearchResult` 接口
  - [x] 定义 API 响应类型

---

### 阶段三：Electron 主进程实现

- [x] **3.1 主进程入口**
  - [x] 创建 `src/main/index.ts`
  - [x] 实现窗口创建
  - [x] 配置 webPreferences（contextIsolation, nodeIntegration）
  - [x] 实现开发/生产环境加载
  - [x] 优化窗口配置（尺寸、最小尺寸、标题栏样式）

- [x] **3.2 Preload 脚本**
  - [x] 更新 `src/preload/index.ts`
  - [x] 暴露 book API（create, update, delete, getById, getAll, search）
  - [x] 暴露 document API（upload, delete, open, countWords, getByBookId, update）
  - [x] 暴露 search API（youshu）
  - [x] 添加 TypeScript 类型声明（`src/preload/index.d.ts`）

- [x] **3.3 IPC 处理器**
  - [x] 创建 `src/main/ipc/bookHandler.ts`
    - [x] book:create
    - [x] book:update
    - [x] book:delete
    - [x] book:getById
    - [x] book:getAll
    - [x] book:search
  - [x] 创建 `src/main/ipc/documentHandler.ts`
    - [x] document:upload
    - [x] document:delete
    - [x] document:open
    - [x] document:countWords（预留接口）
    - [x] document:getByBookId
    - [x] document:update
  - [x] 创建 `src/main/ipc/searchHandler.ts`
    - [x] search:youshu（预留接口，待后续实现爬虫功能）

---

### 阶段四：Vue 前端基础框架

- [x] **4.1 路由配置**
  - [x] 创建 `src/router/index.ts`
  - [x] 配置路由
    - [x] / (Home - 书籍列表)
    - [x] /book/:id (书籍详情)
    - [x] /add (添加书籍)
    - [x] /statistics (统计分析)
    - [x] /settings (设置)

- [x] **4.2 状态管理**
  - [x] 创建 `src/stores/book.ts`
    - [x] state: books, currentBook, loading, searchKeyword
    - [x] getters: filteredBooks, totalWordCount, booksByStatus
    - [x] actions: fetchBooks, fetchBookById, createBook, updateBook, deleteBook, searchBooks, setSearchKeyword, clearSearch, setCurrentBook
  - [x] 创建 `src/stores/ui.ts`
    - [x] state: theme, viewMode, sidebarCollapsed
    - [x] actions: toggleTheme, setTheme, setViewMode, toggleSidebar, setSidebarCollapsed
    - [x] 主题持久化（localStorage）
    - [x] 自动主题（跟随系统）
  - [x] 创建 `src/stores/stats.ts`
    - [x] getters: totalBooks, totalWordCount, finishedBooks, readingBooks, unreadBooks, averageRating
    - [x] getters: categoryStats, platformStats, statusStats, monthlyStats

- [x] **4.3 API 层**
  - [x] 完善 `src/api/book.ts`
    - [x] getAll()
    - [x] getById(id)
    - [x] create(data)
    - [x] update(id, data)
    - [x] delete(id)
    - [x] search(keyword)
  - [x] 创建 `src/api/document.ts`
    - [x] uploadDocument()
    - [x] deleteDocument()
    - [x] openDocument()
    - [x] countWords()
    - [x] getDocumentsByBookId()
    - [x] updateDocument()
  - [x] 创建 `src/api/search.ts`
    - [x] searchYoushu()

---

### 阶段五：核心页面实现（MVP）

- [x] **5.1 主布局**
  - [x] 创建 `src/App.vue`
  - [x] 顶部导航栏（主题切换、移动端折叠）
  - [x] 侧边栏（路由快速导航、添加书籍入口）
  - [x] 主内容区域 + 背景渐变
  - [x] 响应式布局（桌面/移动自适应）

- [x] **5.2 书籍列表页面**
  - [x] 创建 `src/views/Home.vue`
  - [x] 实现网格视图
  - [x] 实现列表视图
  - [x] 视图切换功能（Pinia UI store）
  - [x] 加载状态展示
  - [x] 空状态与无结果提示

- [x] **5.3 书籍卡片组件**
  - [x] 创建 `src/components/BookCard.vue`
  - [x] 展示封面（支持占位）
  - [x] 展示书名、作者、平台
  - [x] 展示字数、评分、阅读状态
  - [x] 搜索关键字高亮 + 悬浮交互

- [x] **5.4 添加书籍页面（手动录入）**
  - [x] 创建 `src/views/AddBook.vue`
  - [x] 创建 `src/components/BookForm.vue`
  - [x] 表单字段：书名、作者、封面上传/链接、平台、类型、描述、字数、阅读状态
  - [x] 校验与错误提示
  - [x] 提交处理与成功/失败反馈

- [x] **5.5 书籍详情页面**
  - [x] 创建 `src/views/BookDetail.vue`
  - [x] 展示完整信息（封面、元数据、简介）
  - [x] 编辑模式（复用 BookForm）
  - [x] 删除按钮
  - [x] 删除确认对话框

- [x] **5.6 搜索功能**
  - [x] 创建 `src/components/SearchBar.vue`
  - [x] 实时搜索（300ms 防抖）
  - [x] 搜索结果高亮（BookCard mark）
  - [x] 清空搜索按钮 + 空结果提示

---

### 阶段六：检索与爬虫功能

- [x] **6.1 爬虫服务实现**
  - [x] 创建 `electron/services/spider.ts`
  - [x] 分析 youshu.me 网页结构
  - [x] 实现搜索功能
  - [x] 解析搜索结果
  - [x] 提取书籍信息
    - [x] 书名
    - [x] 作者
    - [x] 封面URL
    - [x] 字数
    - [x] 平台
    - [x] 描述
  - [x] 错误处理（超时、网络错误）

- [x] **6.2 封面下载功能**
  - [x] 实现封面下载
  - [x] 图片格式转换
  - [x] 图片压缩
  - [x] 保存到本地

- [x] **6.3 前端集成**
  - [x] 添加"从网络检索"选项卡
  - [x] 输入框（书名/作者）
  - [x] 搜索按钮
  - [x] 展示搜索结果
  - [x] 选择结果并导入
  - [x] 加载状态与错误提示

---

### 阶段七：文档管理功能

- [ ] **7.1 文件管理服务**
  - [ ] 创建 `electron/services/fileManager.ts`
  - [ ] 实现文件保存
  - [ ] 实现文件删除
  - [ ] 实现文件打开
  - [ ] 文件路径管理

- [ ] **7.2 字数统计服务**
  - [ ] 创建 `electron/services/wordCounter.ts`
  - [ ] 实现 TXT 字数统计
    - [ ] 编码检测
    - [ ] 文本读取
    - [ ] 字数计算
  - [ ] 实现 EPUB 字数统计
  - [ ] 实现 PDF 字数统计
  - [ ] 实现 DOCX 字数统计
  - [ ] 错误处理

- [ ] **7.3 文档上传组件**
  - [ ] 创建 `src/components/FileUpload.vue`
  - [ ] 点击上传
  - [ ] 拖拽上传
  - [ ] 文件格式验证
  - [ ] 文件大小限制
  - [ ] 上传进度显示

- [ ] **7.4 字数数据源选择**
  - [ ] 展示所有字数来源
    - [ ] 检索字数
    - [ ] 文档字数
    - [ ] 手动输入字数
  - [ ] 选择主字数源
  - [ ] 字数差异提醒

---

### 阶段八：阅读进度管理

- [ ] **8.1 数据库扩展**
  - [ ] 确认 reading_progress 表结构
  - [ ] 实现进度 CRUD

- [ ] **8.2 进度组件**
  - [ ] 创建 `src/components/ProgressBar.vue`
  - [ ] 进度条展示
  - [ ] 百分比显示
  - [ ] 更新进度功能

- [ ] **8.3 状态管理**
  - [ ] 阅读状态选择器
    - [ ] 未读
    - [ ] 阅读中
    - [ ] 已读完
    - [ ] 弃读
    - [ ] 待读
  - [ ] 状态快速切换
  - [ ] 批量修改状态

---

### 阶段九：评分与笔记功能

- [ ] **9.1 评分组件**
  - [ ] 创建 `src/components/RatingStars.vue`
  - [ ] 5星评分显示
  - [ ] 可交互评分
  - [ ] 支持半星

- [ ] **9.2 笔记功能**
  - [ ] 笔记列表展示
  - [ ] 添加笔记
  - [ ] 编辑笔记
  - [ ] 删除笔记
  - [ ] 笔记类型（书评/笔记/摘抄）
  - [ ] 支持 Markdown（可选）

---

### 阶段十：统计分析功能

- [ ] **10.1 统计页面**
  - [ ] 创建 `src/views/Statistics.vue`
  - [ ] 布局设计

- [ ] **10.2 总体统计**
  - [ ] 总书籍数
  - [ ] 总字数
  - [ ] 已读完数量
  - [ ] 平均评分
  - [ ] 卡片式展示

- [ ] **10.3 图表展示**
  - [ ] 集成 ECharts
  - [ ] 类型分布（饼图）
  - [ ] 平台分布（饼图）
  - [ ] 月度趋势（折线图）
  - [ ] 阅读状态分布（柱状图）

- [ ] **10.4 数据导出**
  - [ ] 导出为 Excel
  - [ ] 导出为 CSV
  - [ ] 导出年度报告

---

### 阶段十一：高级功能

- [ ] **11.1 标签系统**
  - [ ] 标签管理页面
  - [ ] 添加/编辑/删除标签
  - [ ] 为书籍打标签
  - [ ] 按标签筛选
  - [ ] 标签颜色管理

- [ ] **11.2 筛选与排序**
  - [ ] 按状态筛选
  - [ ] 按类型筛选
  - [ ] 按平台筛选
  - [ ] 按标签筛选
  - [ ] 多条件组合筛选
  - [ ] 按字数排序
  - [ ] 按添加时间排序
  - [ ] 按评分排序

- [ ] **11.3 批量操作**
  - [x] 批量选择（Checkbox）
  - [x] 全选/反选
  - [x] 批量删除
  - [ ] 批量修改状态
  - [ ] 批量添加标签
  - [ ] 批量导出

---

### 阶段十二：数据备份与恢复

- [ ] **12.1 备份功能**
  - [ ] 手动备份
  - [ ] 自动备份（每周）
  - [ ] 备份文件管理
  - [ ] 保留最近10个备份
  - [ ] 显示备份大小

- [ ] **12.2 恢复功能**
  - [ ] 选择备份文件
  - [ ] 预览备份内容
  - [ ] 恢复数据
  - [ ] 恢复前自动备份

- [ ] **12.3 数据导入导出**
  - [ ] 导出为 JSON
  - [ ] 从 JSON 导入
  - [ ] 导出为 Excel
  - [ ] 从 Excel 导入（模板）

---

### 阶段十三：UI 优化与主题

- [ ] **13.1 主题系统**
  - [ ] 明亮主题
  - [ ] 暗黑主题
  - [ ] 主题切换功能
  - [ ] 跟随系统主题
  - [ ] 主题持久化

- [ ] **13.2 界面定制**
  - [ ] 字体大小调整
  - [ ] 封面尺寸调整
  - [ ] 列表密度调整
  - [ ] 布局保存

- [ ] **13.3 交互优化**
  - [ ] 加载动画
  - [ ] 骨架屏
  - [ ] 过渡动画
  - [ ] 确认对话框
  - [ ] Toast 提示

---

### 阶段十四：性能优化

- [ ] **14.1 数据库优化**
  - [ ] 查询性能分析
  - [ ] 添加必要索引
  - [ ] 分页查询
  - [ ] 查询缓存

- [ ] **14.2 前端性能优化**
  - [ ] 虚拟滚动（vue-virtual-scroller）
  - [ ] 图片懒加载
  - [ ] 组件懒加载
  - [ ] 防抖节流
  - [ ] 减少重渲染

- [ ] **14.3 打包优化**
  - [ ] 代码分割
  - [ ] Tree Shaking
  - [ ] 压缩混淆
  - [ ] 资源压缩

---

### 阶段十五：测试与文档

- [ ] **15.1 单元测试**
  - [ ] 数据库服务测试
  - [ ] 爬虫服务测试
  - [ ] 字数统计测试
  - [ ] Vue 组件测试

- [ ] **15.2 端到端测试**
  - [ ] 添加书籍流程测试
  - [ ] 搜索流程测试
  - [ ] 文档上传流程测试

- [ ] **15.3 用户文档**
  - [ ] 使用手册
  - [ ] 常见问题
  - [ ] 更新日志

---

### 阶段十六：打包与发布

- [ ] **16.1 应用图标**
  - [ ] 设计应用图标
  - [ ] 准备多尺寸图标
  - [ ] 配置 icon

- [ ] **16.2 打包配置**
  - [ ] 配置 electron-builder.json
  - [ ] Windows 配置（NSIS）
  - [ ] 打包测试

- [ ] **16.3 自动更新**
  - [ ] 配置更新服务器
  - [ ] 实现更新检测
  - [ ] 实现自动下载
  - [ ] 实现安装更新

- [ ] **16.4 发布**
  - [ ] 创建 GitHub Release
  - [ ] 上传安装包
  - [ ] 编写发布说明
  - [ ] 推广宣传

---

## 🎯 里程碑

### Milestone 1: MVP (最小可行产品)

**目标日期**: 第4周

- [x] 项目初始化
- [ ] 数据库实现
- [ ] 手动添加书籍
- [ ] 书籍列表展示
- [ ] 基本 CRUD 操作

**验收标准**: 能够手动添加、查看、编辑、删除书籍

---

### Milestone 2: 核心功能完善

**目标日期**: 第8周

- [ ] 网络检索功能
- [ ] 文档上传
- [ ] 字数统计
- [ ] 阅读进度管理

**验收标准**: 能够通过检索添加书籍，上传文档并统计字数

---

### Milestone 3: 高级功能

**目标日期**: 第12周

- [ ] 评分与笔记
- [ ] 统计分析
- [ ] 标签系统
- [ ] 数据备份

**验收标准**: 完整的阅读管理体验，数据安全可靠

---

### Milestone 4: 打磨与发布

**目标日期**: 第16周

- [ ] UI 优化
- [ ] 性能优化
- [ ] 测试完善
- [ ] 打包发布

**验收标准**: 可发布的稳定版本

---

## 📝 开发日志

### 2024-11-24

- [x] 创建项目文档
  - [x] 需求分析文档
  - [x] 技术选型与架构设计
  - [x] 快速启动指南
  - [x] 补充功能与设计说明
  - [x] 开发任务清单
- [x] 创建数据库结构文件 (schema.sql)
- [x] 创建 .gitignore
- [x] 创建 README.md

### 2024-11-24（下午）

- [x] 完成阶段一：项目初始化与环境搭建
  - [x] 修改 electron.vite.config.ts，添加 Element Plus 自动导入配置
  - [x] 创建项目目录结构（router, stores, api, types, views, utils）
  - [x] 创建路由配置文件（router/index.ts）
  - [x] 创建 Pinia Store 配置文件（stores/index.ts）
  - [x] 修改 main.ts，集成 router 和 pinia，导入 Element Plus 样式
  - [x] 创建基础 TypeScript 类型定义（types/book.ts, types/api.ts）
  - [x] 创建基础视图组件（Home, BookDetail, AddBook, Statistics, Settings）
  - [x] 创建工具函数（utils/format.ts）
  - [x] 创建常量定义（constants/index.ts）
  - [x] 创建 API 接口层基础文件（api/book.ts）
  - [x] 安装 vue-router 和 pinia
  - [x] 更新 App.vue 使用 RouterView

### 2024-11-24（晚上）

- [x] 完成阶段二：数据库设计与服务实现
  - [x] 完善 TypeScript 类型定义（添加 Note, Tag, ReadingProgress 等接口）
  - [x] 创建数据库服务文件 `src/main/services/database.ts`
  - [x] 实现数据库初始化功能（读取并执行 schema.sql）
  - [x] 实现书籍 CRUD 操作（createBook, getBookById, getAllBooks, updateBook, deleteBook, searchBooks）
  - [x] 实现文档 CRUD 操作（createDocument, getDocumentById, getDocumentsByBookId, updateDocument, deleteDocument）
  - [x] 实现笔记 CRUD 操作（createNote, getNoteById, getNotesByBookId, updateNote, deleteNote）
  - [x] 实现标签 CRUD 操作（createTag, getTagById, getAllTags, getTagByName, updateTag, deleteTag, addTagToBook, removeTagFromBook, getTagsByBookId）
  - [x] 实现阅读进度 CRUD 操作（upsertReadingProgress, getReadingProgressByBookId, deleteReadingProgress）
  - [x] 在主进程中集成数据库服务（app.whenReady 时初始化，before-quit 时关闭连接）

### 2024-11-24（晚上 - 续）

- [x] 完成阶段三：Electron 主进程实现
  - [x] 优化主进程入口（窗口配置、环境加载、安全设置）
  - [x] 创建 IPC 处理器（bookHandler.ts, documentHandler.ts, searchHandler.ts）
  - [x] 更新 Preload 脚本，暴露所有 API 接口
  - [x] 添加完整的 TypeScript 类型声明
  - [x] 在主进程中注册所有 IPC 处理器
  - [x] 实现统一的错误处理和响应格式（ApiResponse）

### 2024-11-24（晚上 - 续2）

- [x] 完成阶段四：Vue 前端基础框架
  - [x] 完善路由配置（所有页面路由已配置）
  - [x] 完善 API 层（book.ts, document.ts, search.ts），全部调用 Electron IPC
  - [x] 创建 book store（包含完整的 CRUD 操作和搜索功能）
  - [x] 创建 ui store（主题管理、视图模式、侧边栏状态，支持持久化）
  - [x] 创建 stats store（基于 book store 计算各种统计数据）
  - [x] 实现统一的错误处理机制

### 2024-11-25

- [x] 完成阶段五：核心页面实现（MVP）
  - [x] App.vue 主布局（响应式侧边栏、顶部导航、主题切换）
  - [x] Home.vue 书籍列表（网格/列表视图、加载/空状态、统计信息）
  - [x] BookCard.vue 展示组件（封面占位、字数/状态/评分、搜索高亮）
  - [x] BookForm.vue + AddBook.vue（完整表单、封面上传、校验与反馈）
  - [x] BookDetail.vue（信息展示、编辑、删除确认）
  - [x] SearchBar.vue（防抖搜索、清空按钮、Pinia 集成）

### [日期]

- [ ] ...

---

## 💡 提示

- ✅ 已完成
- 🔄 进行中
- ⏸️ 暂停
- ❌ 已取消

**建议：**

1. 按阶段逐步完成，不要跳跃
2. 每完成一个任务就打勾，保持成就感
3. 遇到困难及时记录，避免重复踩坑
4. 定期回顾进度，调整计划

**加油！期待你的完成！** 🚀
