---
alwaysApply: true
---

# 项目结构指南

这是一个基于 Electron + Vue 3 + TypeScript 的书籍管理应用（iBook）。

## 核心架构

### 主进程 (src/main/)
- **入口**: [src/main/index.ts](mdc:src/main/index.ts) - Electron 主进程入口，负责窗口创建、数据库初始化、IPC 处理器注册
- **IPC 处理器**: [src/main/ipc/](mdc:src/main/ipc/) - 处理渲染进程的 IPC 请求
  - `bookHandler.ts` - 书籍 CRUD 操作
  - `documentHandler.ts` - 文档管理
  - `searchHandler.ts` - 网络搜索（youshu.me）
  - `statsHandler.ts` - 统计数据
  - `tagHandler.ts` - 标签管理
- **服务层**: [src/main/services/](mdc:src/main/services/) - 业务逻辑服务
  - `database.ts` - SQLite 数据库操作
  - `spider.ts` - 网络爬虫服务
  - `fileManager.ts` - 文件管理
  - `wordCounter.ts` - 字数统计
  - `cover.ts` - 封面下载
  - `windowState.ts` - 窗口状态管理

### 预加载脚本 (src/preload/)
- [src/preload/index.ts](mdc:src/preload/index.ts) - 通过 `contextBridge` 暴露安全的 API 给渲染进程
- [src/preload/index.d.ts](mdc:src/preload/index.d.ts) - TypeScript 类型定义

### 渲染进程 (src/renderer/src/)
- **入口**: [src/renderer/src/main.ts](mdc:src/renderer/src/main.ts) - Vue 应用入口
- **路由**: [src/renderer/src/router/](mdc:src/renderer/src/router/) - Vue Router 配置
- **状态管理**: [src/renderer/src/stores/](mdc:src/renderer/src/stores/) - Pinia stores
- **页面**: [src/renderer/src/views/](mdc:src/renderer/src/views/) - 路由级页面组件
- **组件**: [src/renderer/src/components/](mdc:src/renderer/src/components/) - 可复用组件
- **API 层**: [src/renderer/src/api/](mdc:src/renderer/src/api/) - 调用 Electron API 的封装
- **类型定义**: [src/renderer/src/types/](mdc:src/renderer/src/types/) - TypeScript 类型

## 数据流

1. **渲染进程** → 调用 `window.electronAPI.*` → **预加载脚本** → **主进程 IPC 处理器** → **服务层** → **数据库/文件系统**

## 技术栈

- **框架**: Electron 39, Vue 3, TypeScript
- **UI**: Element Plus, CSS Variables (支持暗色主题)
- **状态管理**: Pinia
- **数据库**: SQLite (better-sqlite3)
- **构建工具**: Vite, electron-vite
- **打包**: electron-builder

## 重要约定

- 所有 IPC 通信必须通过预加载脚本暴露的 API
- 数据库操作统一在 `databaseService` 中
- 文件操作统一在 `fileManager` 中
- 使用 TypeScript 严格模式
- 遵循 Vue 3 Composition API 风格

## 文件命名规范

### TypeScript 文件
- 使用 kebab-case：`book-handler.ts`、`document-service.ts`
- Handler 文件：`*Handler.ts`
- Service 文件：`*.ts`（在 services 目录下）

### Vue 组件
- 使用 PascalCase：`BookCard.vue`、`BookForm.vue`
- 页面组件放在 `views/` 目录
- 可复用组件放在 `components/` 目录

### 类型定义
- 使用 kebab-case：`book.ts`、`api.ts`
- 统一在 `types/` 目录下
- 通过 `types/index.ts` 统一导出

## 导入路径规范

- 相对路径：同级目录 `./bookHandler`，上级目录 `../services/database`
- 避免超过 2 层相对路径
- 优先使用命名导出：`export function createBook() {}`
- 仅在必要时使用默认导出（如 Vue 组件）

## 代码组织原则

- **单一职责**：每个文件只负责一个功能模块
- **依赖方向**：Views → Components → Stores → API → Preload → IPC → Services → Database
- **避免循环依赖**：使用依赖注入，提取公共类型到独立文件

## 新增功能时的文件创建

新增业务模块（如"笔记"功能）时的文件创建顺序：

1. 类型定义：`src/renderer/src/types/note.ts`
2. 数据库服务：在 `src/main/services/database.ts` 中添加方法
3. IPC 处理器：`src/main/ipc/noteHandler.ts`
4. 预加载 API：在 `src/preload/index.ts` 中添加
5. API 层：`src/renderer/src/api/note.ts`
6. Store：`src/renderer/src/stores/note.ts`
7. 组件：`src/renderer/src/components/NoteCard.vue`
8. 页面：`src/renderer/src/views/NoteManagement.vue`
9. 路由：在 `src/renderer/src/router/index.ts` 中添加
