---
alwaysApply: true
---

# 项目结构指南

这是一个基于 Electron + Vue 3 + TypeScript 的书籍管理应用（iBook）。

## 核心架构

### 主进程 (src/main/)
- **入口**: [src/main/index.ts](mdc:src/main/index.ts) - Electron 主进程入口，负责窗口创建、数据库初始化、IPC 处理器注册
- **IPC 处理器**: [src/main/ipc/](mdc:src/main/ipc/) - 处理渲染进程的 IPC 请求
  - `bookHandler.ts` - 书籍 CRUD 操作
  - `documentHandler.ts` - 文档管理
  - `searchHandler.ts` - 网络搜索（youshu.me）
  - `statsHandler.ts` - 统计数据
  - `tagHandler.ts` - 标签管理
- **服务层**: [src/main/services/](mdc:src/main/services/) - 业务逻辑服务
  - `database.ts` - SQLite 数据库操作
  - `spider.ts` - 网络爬虫服务
  - `fileManager.ts` - 文件管理
  - `wordCounter.ts` - 字数统计
  - `cover.ts` - 封面下载
  - `windowState.ts` - 窗口状态管理

### 预加载脚本 (src/preload/)
- [src/preload/index.ts](mdc:src/preload/index.ts) - 通过 `contextBridge` 暴露安全的 API 给渲染进程
- [src/preload/index.d.ts](mdc:src/preload/index.d.ts) - TypeScript 类型定义

### 渲染进程 (src/renderer/src/)
- **入口**: [src/renderer/src/main.ts](mdc:src/renderer/src/main.ts) - Vue 应用入口
- **路由**: [src/renderer/src/router/](mdc:src/renderer/src/router/) - Vue Router 配置
- **状态管理**: [src/renderer/src/stores/](mdc:src/renderer/src/stores/) - Pinia stores
- **页面**: [src/renderer/src/views/](mdc:src/renderer/src/views/) - 路由级页面组件
- **组件**: [src/renderer/src/components/](mdc:src/renderer/src/components/) - 可复用组件
- **API 层**: [src/renderer/src/api/](mdc:src/renderer/src/api/) - 调用 Electron API 的封装
- **类型定义**: [src/renderer/src/types/](mdc:src/renderer/src/types/) - TypeScript 类型

## 数据流

1. **渲染进程** → 调用 `window.electronAPI.*` → **预加载脚本** → **主进程 IPC 处理器** → **服务层** → **数据库/文件系统**

## 技术栈

- **框架**: Electron 39, Vue 3, TypeScript
- **UI**: Element Plus, CSS Variables (支持暗色主题)
- **状态管理**: Pinia
- **数据库**: SQLite (better-sqlite3)
- **构建工具**: Vite, electron-vite
- **打包**: electron-builder

## 重要约定

- 所有 IPC 通信必须通过预加载脚本暴露的 API
- 数据库操作统一在 `databaseService` 中
- 文件操作统一在 `fileManager` 中
- 使用 TypeScript 严格模式
- 遵循 Vue 3 Composition API 风格
